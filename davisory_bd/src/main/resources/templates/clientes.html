<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Lista de Clientes</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/tabelas.css}">
</head>
<body>
    <div class="topo">
        <a href="/inicio" class="botao-voltar">← Voltar</a> 
    </div>

    <h1>Clientes</h1>

    <div style="margin-bottom: 20px;">
        <a href="/clientes/adicionar" class="btn">+ Adicionar Cliente</a>
    </div>

    <table>
        <thead>
            <tr>
                <th>CPF/CNPJ</th>
                <th>Nome</th>
                <th>Telefone</th>
                <th>Email</th>
                <th>Endereço</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="cliente : ${clientes}">
                <td th:text="${cliente.cpfCnpjCliente}"></td>
                <td th:text="${cliente.nomeCliente}"></td>
                <td th:text="${cliente.telefoneCliente}"></td>
                <td th:text="${cliente.emailCliente}"></td>
                <td>
                    <a th:if="${cliente.endereco != null}"
                       th:href="@{/enderecos/{id}(id=${cliente.endereco.idEndereco})}"
                       class="botao-endereco">
                        Ver Endereço
                    </a>
                </td>
                <td>
                    <a th:href="@{/clientes/editar/{cpfCnpj}(cpfCnpj=${cliente.cpfCnpjCliente})}" class="btn">Editar</a>
                </td>
            </tr>            
        </tbody>
    </table>

    <div style="margin-top: 40px;">
        <h2>Gráfico de Distribuição de Clientes por Inicial</h2>
        <canvas id="graficoClientes" width="300" height="150"></canvas>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script th:inline="javascript">
        const clientes = [[${clientes}]];
        const contagemIniciais = {};
    
        clientes.forEach(c => {
            let inicial = c.nomeCliente.charAt(0).toUpperCase();
            contagemIniciais[inicial] = (contagemIniciais[inicial] || 0) + 1;
        });
    
        const labels = Object.keys(contagemIniciais);
        const dados = Object.values(contagemIniciais);
    
        const ctx = document.getElementById('graficoClientes').getContext('2d');
        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Clientes por Inicial',
                    data: dados,
                    backgroundColor: 'rgba(54, 162, 235, 0.7)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    </script>    
</body>
</html>
